---
openapi: 3.0.2
info:
  title: Proxia MES Monitoring Dashboard GUI Service API
  description: Proxia MES Monitoring Dashboard GUI Service API
  version: '1.0.5'
servers:
  - url: "/proxia/mes/montoring-dashboard/gui-service/v1"
tags:
  - name: dashboard
    description: Everything about dashboard views
  - name: widget
    description: Everything about dashboard widgets
paths:
  "/dashboards":
    get:
      tags:
        - dashboard
      summary: returns all dashboards for a user
      parameters:
        - name: userId
          in: query
          description: the userId
          required: true
          style: form
          schema:
            type: string
            maxLength: 10
            minLength: 3
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/dashboard"
        '204':
          description: No Content
          content: { }
        '400':
          description: Bad Request
          content: { }
        '401':
          description: Unauthorized
          content: { }
        '403':
          description: Forbidden
          content: { }
        '500':
          description: Internal Server Error
          content: { }
  "/dashboard/{userId}/{dashboardId}":
    delete:
      tags:
        - dashboard
      summary: deletes a dashboard for a user
      parameters:
        - name: userId
          in: path
          description: the userId
          required: true
          style: form
          schema:
            type: string
            maxLength: 10
            minLength: 3
        - name: dashboardId
          in: path
          description: the dashboardId
          required: true
          style: form
          schema:
            type: number
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/dashboard"
        '204':
          description: No Content
          content: { }
        '400':
          description: Bad Request
          content: { }
        '401':
          description: Unauthorized
          content: { }
        '403':
          description: Forbidden
          content: { }
        '500':
          description: Internal Server Error
          content: { }
    get:
      tags:
        - dashboard
      summary: returns a dashboard for a user
      parameters:
        - name: userId
          in: path
          description: the userId
          required: true
          style: form
          schema:
            type: string
            maxLength: 10
            minLength: 3
        - name: dashboardId
          in: path
          description: the dashboardId
          required: true
          style: form
          schema:
            type: number
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/dashboard"
        '204':
          description: No Content
          content: { }
        '400':
          description: Bad Request
          content: { }
        '401':
          description: Unauthorized
          content: { }
        '403':
          description: Forbidden
          content: { }
        '500':
          description: Internal Server Error
          content: { }
  "/dashboard/{userId}":
    post:
      tags:
        - dashboard
      summary: adds a new dashboard for a user
      security:
        - OpenID:
            - admin
      parameters:
        - name: userId
          in: path
          description: the userId
          required: true
          style: form
          schema:
            type: string
            maxLength: 10
            minLength: 3
      requestBody:
        description: dashboard object
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/dashboard"
        required: true
      responses:
        '200':
          description: OK
          content: { }
        '400':
          description: Bad Request
          content: { }
        '401':
          description: Unauthorized
          content: { }
        '403':
          description: Forbidden
          content: { }
        '409':
          description: Conflict
          content: { }
        '500':
          description: Internal Server Error
          content: { }
    put:
      tags:
        - dashboard
      summary: modifies an existing dashboard for a user
      security:
        - OpenID:
            - admin
      parameters:
        - name: userId
          in: path
          description: the userId
          required: true
          style: form
          schema:
            type: string
            maxLength: 10
            minLength: 3
      requestBody:
        description: dashboard object
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/dashboard"
        required: true
      responses:
        '200':
          description: OK
          content: { }
        '400':
          description: Bad Request
          content: { }
        '401':
          description: Unauthorized
          content: { }
        '403':
          description: Forbidden
          content: { }
        '409':
          description: Conflict
          content: { }
        '500':
          description: Internal Server Error
          content: { }
components:
  securitySchemes:
    OpenID:
      type: openIdConnect
      openIdConnectUrl: http://localhost:8080/auth/realms/xi-mes/.well-known/openid-configuration
  schemas:
    dashboard:
      type: object
      required:
        - id
        - name
        - widgets
      properties:
        id:
          type: number
          description: The id of a dashboard
        name:
          type: string
          description: The name of a dashboard
          maxLength: 10
          minLength: 3
        description:
          type: string
          description: The description of a dashboard
          maxLength: 255
          minLength: 0
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/widget'
          minItems: 0
          maxItems: 100
    widget:
      type: object
      required:
        - id
        - name
        - performance_indicator
        - resource
        - time
        - chart
      properties:
        id:
          type: number
          description: The id of a widget
        name:
          type: string
          description: The name of a widget
          maxLength: 10
          minLength: 3
        description:
          type: string
          description: The description of a widget
          maxLength: 255
          minLength: 0
        performance_indicator:
          type: string
          description: The performance-indicator visualized by the widget
          enum:
            - 'RESOURCE_STATE'
            - 'RESOURCE_UTILIZATION'
            - 'TIMELINESS_ORDER_PLANNING'
        resource:
          type: string
          description: The resource visualized by the widget
          enum:
            - 'MACHINE'
            - 'WORKPLACE'
            - 'PERSON'
        time:
          type: object
          oneOf:
            - $ref: '#/components/schemas/time_moments'
            - $ref: '#/components/schemas/time_periods'
        chart:
          type: object
          oneOf:
            - $ref: '#/components/schemas/summarizing_chart'
            - $ref: '#/components/schemas/timeline_chart'
            - $ref: '#/components/schemas/time_moment_chart'
    time_moments:
      type: string
      enum:
        - 'NOW'
        - 'CURRENT_SHIFT_START'
        - 'CURRENT_SHIFT_STOP'
        - 'LAST_SHIFT_START'
        - 'LAST_SHIFT_STOP'
        - 'PENULTIMATE_SHIFT_START'
        - 'PENULTIMATE_SHIFT_STOP'
    time_periods:
      type: string
      enum:
        - 'LAST_5_MIN'
        - 'LAST_15_MIN'
        - 'LAST_30_MIN'
        - 'LAST_1_HOUR'
        - 'LAST_4_HOUR'
        - 'LAST_SHIFT'
        - 'WORKDAY'
        - 'WORKWEEK'
        - 'MONTH'
    timeline_chart:
      type: string
      description: The chart for a timeline
      enum:
        - 'STACKED_HORIZONTAL_BAR_CHART'
    time_moment_chart:
      type: string
      description: The chart for a time_moment
      enum:
        - 'VALUE_CARD'
    summarizing_chart:
      type: object
      required: 
        - chart
        - unit
      properties: 
        chart:
          type: string
          description: The visualitation of the widget
          enum:
            - 'BAR_CHART'
            - 'PIE_CHART'
            - 'LINE_CHART'
            - 'VALUE_WITH_SPARKLINE'
            - 'TREE_MAP_CHART'
        unit:
          type: string
          description: The time unit for grouping summarizing charts
          enum:
            - 'MINUTE'
            - 'HOUR'
            - 'SHIFT'
            - 'WORKDAY'
            - 'WORKWEEK'
        calc_no_shift_time:
          type: boolean
          description: calc no shift time on summarizing visualisation
          default: false
          
          
       